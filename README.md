#nann

## nann Python接口

### 接口列表

|接口名|参数|参数说明|返回值|说明|
|---|---|---|---|---|
|load|无|错误代码|加载nann库，在最之前调用|
|unload|无|无|错误代码|卸载nann库，在进程结束时调用，与load成对使用|
|create|task|任务名(ID)，用来标示任务|当前创建管理器的总数|创建一个nann管理器，此管理器只训练任务task|
||**create.json**|一段json代码，用于描述神经网络，详细参见后面的章节|||
||max_calc|容纳计算结点(线程)最大数量|||
||now_calc|当前要启动的计算结点(可选参数)|||
|destroy|task|任务名|错误代码|销毁与task关联的nann管理器|
|exptype|exp|1:抛出异常,0:返回错误代码|无|修改异常处理类型|
|training|task|任务名|错误代码|有目标训练，进入回调函数，调整权值矩阵，输出结果|
||**input.json**|一段json代码，用于描述输入，详细参加后面的章节|||
|training_notarget|task|任务名|错误代码|无目标训练，进入回调函数，不调整权值矩阵，输出结果，仅用来做分类计算|
||**input.json**|一段json代码，用于描述输入，详细参加后面的章节|||
|training_nooutput|task|任务名|错误代码|有目标训练，进入回调函数，调整权值矩阵，不输出结果，仅用来做训练|
|nnn_read|filename|文件路径|失败:0成功:1|读取一个nnn文件到内存中，可直接使用任务名进行计算，**当前版本不支持**|
|nnn_write|task|任务名|错误代码|写入一个任务的神经网络到nnn文件中，**当前版本不支持**|
||filename|文件名|||
|test|无|无|无|测试是否工作正常，无实际意义|
|version|无|无|版本字符串|返回当前nann版本(按圆周率计算)|
|print|task|任务名|错误代码|打印当前任务的ann内容到控制台|
|iscalcing|task|任务名|任务点数量|还有多少正在进行运算的任务结点|
|merge|task|任务名|错误代码|合并当前计算完毕的任务结点的ann为一个|

### 使用说明
```python
import nann

print nann.version()  # 不加载也可以使用

nann.load()

# 修改异常类型为不抛出异常，由自己控制错误代码
nann.exptype(0)
# 接收任务
if (nann.create(task, nann_json) != 0):
    print "创建错误"

if (nann.training(task, samples_json) != 0):
    print "训练错误"
    
# ... 其余的代码

# 销毁
nann.destroy(task)

# 可创建其他的任务结点

nann.unload()
```
### 错误代码
|错误代码|说明|级别|
|---|
|0x88000000|内部错误|错误|
|0x88000001|分析JSON文件错误|错误|
|0x88000100|参数错误|错误|
|0x88000101|任务已经存在|错误|
|0x88000102|任务不存在|错误|
|0x88000200|分配内存失败|错误|
|0x87000000|内部警告|警告|
|0x87000100|参数错误|警告|
|0x87000101|任务已经存在|警告|
|0x87000102|任务不存在|警告|

其中**警告**的意思是，不影响当前运行，但是可能会发生意外。**错误**级别直接退出运行。

### json输入详解
在以下两份json中，都存在**target**一项，其中input.json中的**target**会覆盖掉create.json中的**target**。后者为全局配置目标。在每次实际训练中调节。

#### create.json
```json
{
	"alg": "rcalc",
	"ann": {
		"weight matrixes": {
			"0": {
				"r1": [0.75, 0.83, 0.39],
				"r2": [0.98, 0.43, 0.12],
				"r3": [0.12, 0.45, 0.78],
				"r4": [0.11, 0.12, 0.65],
				"r5": [0.56, 0.67, 0.34]
			},
			"1": {
				"r1": [0.35, 0.23, 0.19, 0.37],
				"r2": [0.51, 0.49, 0.72, 0.11],
				"r3": [0.24, 0.31, 0.71, 0.51]
			},
			"2": {
				"r1": [0.15, 0.25, 0.41],
				"r2": [0.21, 0.29, 0.25],
				"r3": [0.34, 0.11, 0.87],
				"r4": [0.61, 0.92, 0.93]
			}
		},
		"delta weight matrixes": {
			"0": {
				"r1": [0.07, 0.08, 0.09],
				"r2": [0.09, 0.04, 0.02],
				"r3": [0.01, 0.04, 0.08],
				"r4": [0.01, 0.02, 0.05],
				"r5": [0.05, 0.07, 0.04]
			},
			"1": {
				"r1": [0.05, 0.03, 0.09, 0.07],
				"r2": [0.01, 0.09, 0.02, 0.01],
				"r3": [0.04, 0.01, 0.01, 0.01]
			},
			"2": {
				"r1": [0.05, 0.05, 0.01],
				"r2": [0.01, 0.09, 0.05],
				"r3": [0.04, 0.01, 0.07],
				"r4": [0.01, 0.02, 0.03]
			}
		}
	},
	"target": [0.11, 0.23, 0.78]
}
```
#### input.json
```json
{
	"samples": {
		"t1": [0.1, 0.2, 0.34, 0.45, 0.55],
		"t2": [0.21, 0.6, 0.4, 0.23, 0.51],
		"t3": [0.31, 0.7, 0.31, 0.1, 0.46],
		"t4": [0.41, 0.9, 0.21, 0.61, 0.78]
	},
	"target": [0.11, 0.23, 0.78]
}
```
